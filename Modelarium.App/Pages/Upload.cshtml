@page
@model UploadModel
@{
    ViewData["Title"] = "Upload Model";
}

<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <h1>Upload New Model</h1>
                <div>
                    <a href="/Models" class="btn btn-outline-primary">
                        <i class="fas fa-arrow-left me-2"></i>Back to Models
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col-lg-8">
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">Upload Model File</h5>
                </div>
                <div class="card-body">
                    <form id="uploadForm">
                        <div class="mb-4">
                            <div class="upload-area text-center p-5 border border-secondary rounded bg-dark">
                                <i class="fas fa-cloud-upload-alt fa-4x text-danger mb-3"></i>
                                <h4>Drag & Drop Files Here</h4>
                                <p class="text-muted">or click to browse files</p>
                                <input type="file" id="fileUpload" class="d-none" accept=".gguf,.ggml">
                                <button type="button" id="browseBtn" class="btn btn-outline-primary mt-3">
                                    <i class="fas fa-folder-open me-2"></i>Browse Files
                                </button>
                            </div>
                        </div>
                        
                        <div id="fileDetails" class="d-none mb-4">
                            <div class="card bg-dark">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="p-3 rounded-circle bg-black me-3">
                                            <i class="fas fa-file-alt text-danger fa-2x"></i>
                                        </div>
                                        <div class="flex-grow-1">
                                            <h5 class="mb-1" id="fileName">filename.gguf</h5>
                                            <div class="d-flex justify-content-between">
                                                <span class="text-muted" id="fileSize">0 MB</span>
                                                <button type="button" id="removeFile" class="btn btn-sm btn-link text-danger p-0">
                                                    <i class="fas fa-times me-1"></i>Remove
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="uploadProgress" class="d-none mb-4">
                            <label class="form-label d-flex justify-content-between">
                                <span>Upload Progress</span>
                                <span id="progressPercent">0%</span>
                            </label>
                            <div class="progress" style="height: 10px;">
                                <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated bg-danger" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="modelName" class="form-label">Model Name</label>
                            <input type="text" class="form-control bg-dark text-light border-secondary" id="modelName" placeholder="e.g. Llama2-7B">
                        </div>
                        
                        <div class="mb-3">
                            <label for="modelDesc" class="form-label">Description</label>
                            <textarea class="form-control bg-dark text-light border-secondary" id="modelDesc" rows="3" placeholder="Short description of the model..."></textarea>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6 mb-3 mb-md-0">
                                <label for="modelParams" class="form-label">Parameters</label>
                                <select class="form-select bg-dark text-light border-secondary" id="modelParams">
                                    <option selected>Select parameter size</option>
                                    <option value="1B">1 Billion</option>
                                    <option value="3B">3 Billion</option>
                                    <option value="7B">7 Billion</option>
                                    <option value="13B">13 Billion</option>
                                    <option value="34B">34 Billion</option>
                                    <option value="70B">70 Billion</option>
                                </select>
                            </div>
                            
                            <div class="col-md-6">
                                <label for="modelContext" class="form-label">Context Window</label>
                                <select class="form-select bg-dark text-light border-secondary" id="modelContext">
                                    <option selected>Select context size</option>
                                    <option value="2K">2K tokens</option>
                                    <option value="4K">4K tokens</option>
                                    <option value="8K">8K tokens</option>
                                    <option value="16K">16K tokens</option>
                                    <option value="32K">32K tokens</option>
                                    <option value="64K">64K tokens</option>
                                    <option value="128K">128K tokens</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label class="form-label">Model Type</label>
                            <div class="d-flex">
                                <div class="form-check me-4">
                                    <input class="form-check-input" type="radio" name="modelType" id="typeGGUF" value="GGUF" checked>
                                    <label class="form-check-label" for="typeGGUF">GGUF</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="modelType" id="typeGGML" value="GGML">
                                    <label class="form-check-label" for="typeGGML">GGML</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-check mb-4">
                            <input class="form-check-input" type="checkbox" id="activateAfterUpload">
                            <label class="form-check-label" for="activateAfterUpload">
                                Activate model after upload completes
                            </label>
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button type="button" id="uploadBtn" class="btn btn-primary" disabled>
                                <i class="fas fa-upload me-2"></i>Upload Model
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4">
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">Supported Models</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <h6><i class="fas fa-info-circle text-danger me-2"></i>Compatible Model Formats</h6>
                        <ul class="list-unstyled text-muted ms-4">
                            <li><i class="fas fa-check-circle text-success me-2"></i>GGUF (Recommended)</li>
                            <li><i class="fas fa-check-circle text-success me-2"></i>GGML (Legacy)</li>
                        </ul>
                    </div>
                    
                    <div class="mb-3">
                        <h6><i class="fas fa-microchip text-danger me-2"></i>Hardware Requirements</h6>
                        <div class="table-responsive">
                            <table class="table table-sm table-dark">
                                <thead>
                                    <tr>
                                        <th>Model Size</th>
                                        <th>Minimum RAM</th>
                                        <th>Recommended</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>7B</td>
                                        <td>8 GB</td>
                                        <td>16 GB</td>
                                    </tr>
                                    <tr>
                                        <td>13B</td>
                                        <td>16 GB</td>
                                        <td>32 GB</td>
                                    </tr>
                                    <tr>
                                        <td>34B+</td>
                                        <td>32 GB</td>
                                        <td>64 GB</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div>
                        <h6><i class="fas fa-download text-danger me-2"></i>Find Models</h6>
                        <p class="text-muted small">Looking for pre-built models? Check out these resources:</p>
                        <div class="d-grid gap-2">
                            <a href="/Search" class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-search me-2"></i>Search Ollama Models
                            </a>
                            <a href="https://huggingface.co/models" class="btn btn-sm btn-outline-secondary" target="_blank">
                                <i class="fas fa-external-link-alt me-2"></i>Hugging Face
                            </a>
                            <a href="https://github.com/ggerganov/llama.cpp" class="btn btn-sm btn-outline-secondary" target="_blank">
                                <i class="fab fa-github me-2"></i>llama.cpp Repository
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Upload Guidelines</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <h6><i class="fas fa-exclamation-triangle text-warning me-2"></i>Important Notes</h6>
                        <ul class="text-muted small">
                            <li>Make sure your model file is a compatible GGUF or GGML format</li>
                            <li>Larger models require more RAM and processing power</li>
                            <li>Upload process may take several minutes for large files</li>
                            <li>Do not refresh or leave the page during upload</li>
                        </ul>
                    </div>
                    
                    <div>
                        <h6><i class="fas fa-question-circle text-danger me-2"></i>Need Help?</h6>
                        <p class="text-muted small mb-2">Get assistance with model uploads:</p>
                        <div class="d-grid">
                            <a href="/Documentation" class="btn btn-sm btn-outline-info">
                                <i class="fas fa-book me-2"></i>View Documentation
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Confirmation Modal -->
    <div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content bg-dark">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title" id="confirmModalLabel">Confirm Upload</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to upload this model?</p>
                    <div class="card bg-black p-3 mb-3">
                        <div class="mb-2"><strong>Name:</strong> <span id="confirmName"></span></div>
                        <div class="mb-2"><strong>File:</strong> <span id="confirmFile"></span></div>
                        <div class="mb-2"><strong>Size:</strong> <span id="confirmSize"></span></div>
                        <div><strong>Activate After Upload:</strong> <span id="confirmActivate"></span></div>
                    </div>
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-circle me-2"></i>
                        Large models may take several minutes to upload and process.
                    </div>
                </div>
                <div class="modal-footer border-secondary">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirmUploadBtn">
                        <i class="fas fa-upload me-2"></i>Start Upload
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Success Modal -->
    <div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content bg-dark">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title" id="successModalLabel">Upload Complete</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <div class="mb-4">
                        <i class="fas fa-check-circle text-success fa-5x"></i>
                    </div>
                    <h4 class="mb-3">Model Uploaded Successfully!</h4>
                    <p class="mb-4">Your model has been uploaded and is now available in your model library.</p>
                    <div id="activationMessage" class="alert alert-info d-none">
                        <i class="fas fa-spinner fa-spin me-2"></i>
                        Model activation in progress...
                    </div>
                </div>
                <div class="modal-footer border-secondary">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <a href="/Models" class="btn btn-primary">
                        <i class="fas fa-list me-2"></i>View Models
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Error Modal -->
    <div class="modal fade" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content bg-dark">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title" id="errorModalLabel">Upload Error</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <div class="mb-4">
                        <i class="fas fa-exclamation-triangle text-danger fa-5x"></i>
                    </div>
                    <h4 class="mb-3">Upload Failed</h4>
                    <p id="errorMessage" class="mb-0">An error occurred during the upload process.</p>
                </div>
                <div class="modal-footer border-secondary">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="retryBtn">
                        <i class="fas fa-redo me-2"></i>Try Again
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="js/views/upload.js"></script>
}